<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Support — AI Solo Business</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/style.css">
</head>
<body class="bg-gray-50">
  <header class="bg-white shadow">
    <div class="max-w-6xl mx-auto px-6 py-5 flex items-center justify-between">
      <a href="/" class="text-lg font-semibold">AI Solo Business</a>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-6 py-12">
    <h1 class="text-2xl font-bold">Support</h1>
    <p class="mt-2 text-gray-600">Ask the support bot a question — it will consult the KB and fall back to human escalation if needed.</p>

    <div class="mt-6 bg-white p-6 rounded shadow">
      <div id="chat" class="space-y-3 max-h-80 overflow-auto"></div>

      <form id="supportForm" class="mt-4 flex gap-3">
        <input id="q" required placeholder="Describe your issue..." class="flex-1 border rounded px-3 py-2" />
        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded">Send</button>
      </form>
      <p class="mt-3 text-sm text-gray-500">This demo uses a Pages Function at <code>/api/support</code>.</p>
    </div>
  </main>

<script>
const chat = document.getElementById('chat');
const form = document.getElementById('supportForm');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const q = document.getElementById('q').value.trim();
  if(!q) return;
  appendMsg('You', q);
  document.getElementById('q').value = '';
  appendMsg('Bot', 'Thinking...');
  const res = await fetch('/api/support', {method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({question:q})});
  const data = await res.json();
  // Replace last bot msg
  const botNodes = Array.from(chat.querySelectorAll('.msg')).filter(n => n.dataset.from === 'Bot');
  if(botNodes.length){
    const last = botNodes[botNodes.length-1];
    last.querySelector('.text').textContent = data.answer;
  } else {
    appendMsg('Bot', data.answer);
  }
});

function appendMsg(from, text){
  const el = document.createElement('div');
  el.className = 'msg';
  el.dataset.from = from;
  el.innerHTML = `<strong>${from}:</strong> <span class="text">${text}</span>`;
  chat.appendChild(el);
  chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
